# Source Prezto
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Editor
export EDITOR='nvim'
export VISUAL='nvim'

# Aliases
alias vim='nvim'
alias vi='nvim'
alias pn='pnpm'
alias t='turbo'
alias pr='gh pr create --draft --body "" --title'
alias python=python3
alias pip="python3 -m pip"

# Navigation
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# Modern CLI tools (conditional on install)
if command -v eza &> /dev/null; then
  alias ls='eza -l'
  alias la='eza -la'
  alias tree='eza --tree'
else
  alias ls='ls -Gl'
fi

if command -v bat &> /dev/null; then
  alias cat='bat --style=plain --paging=never'
fi

# Environment
export GOPATH=$HOME/src/go
export KEYTIMEOUT=1
export GPG_TTY=$(tty)

# 1Password SSH agent
export SSH_AUTH_SOCK=~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock

# Vi-mode keybinding overrides (Prezto editor module handles base vi mode)
bindkey '^P' up-history
bindkey '^N' down-history
bindkey '^?' backward-delete-char
bindkey '^h' backward-delete-char
bindkey '^w' backward-kill-word

# PATH additions
PATH=$PATH:$GOPATH/bin

# pnpm
export PNPM_HOME="$HOME/Library/pnpm"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac

# FZF
if command -v fzf &> /dev/null; then
  [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
  export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
  export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
  export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
fi

# fnm (fast node manager)
if command -v fnm &> /dev/null; then
  eval "$(fnm env --use-on-cd)"
fi

# Pyenv (lazy-loaded for faster startup)
export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"

pyenv() {
  unfunction pyenv
  eval "$(command pyenv init -)"
  pyenv "$@"
}

# Deno
[[ -f "$HOME/.deno/env" ]] && . "$HOME/.deno/env"

# zoxide (smart cd)
command -v zoxide &> /dev/null && eval "$(zoxide init zsh)"

# atuin (shell history)
command -v atuin &> /dev/null && eval "$(atuin init zsh --disable-up-arrow)"

# Machine-specific overrides
[[ -f ~/.zshrc.local ]] && source ~/.zshrc.local
